// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B,j,F,I,q,R=[].slice,U={}.hasOwnProperty,z=function(e,t){function r(){this.constructor=e}for(var n in t)U.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},W=function(e,t){return function(){return e.apply(t,arguments)}},X=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};this.__apptools_preinit={},I={},N=function(e,t,n){var r,i,s,o,u,a,f,l,c;n==null&&(n=null);if(e===".")return t[t.length-1];l=e.split(/\./),e=l[0],o=2<=l.length?R.call(l,1):[];for(i=u=c=t.length-1;c<=-1?u<-1:u>-1;i=c<=-1?++u:--u){if(t[i]==null)continue;if(typeof t[i]=="object"&&e in(r=t[i])){n=r[e];break}continue}for(a=0,f=o.length;a<f;a++)s=o[a],n=N(s,[n]);return n instanceof Function&&(n=function(e){return function(){var t;return t=e.apply(r,arguments),t instanceof Function&&t.apply(null,arguments)||t}}(n)),n},T=function(){var e,t,n,r;return n=arguments[0],r=arguments[1],e=3<=arguments.length?R.call(arguments,2):[],function(){var i,s,o;o=[];for(i=0,s=r.length;i<s;i++)t=r[i],o.push(t.call.apply(t,[n].concat(R.call(e))));return o}().join("")},A=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,C,k,L,O,M,_;t==null&&(t=["{{","}}"]),n==null&&(n=null),f=I[L=t.join(" ")]||(I[L]={});if(e in f)return f[e];i=[],r=function(){var e,n;return n=t[0],e=t[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+n+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+e+")","gm")},S=r(),S.lastIndex=b=(n||{start:0}).start,y=function(t,n){var r,i,s,o,u,a,f,l,h,p,d;(s=/$/gm).lastIndex=t,s.exec(e),p=e.substr(0,t).split("\n"),h=p.length,f=p[h-1],d=c+k.length,l=e.substr(d+1,t-d-1),u=(new Array(f.length-l.length+1)).join(" "),r=(new Array(l.length+1)).join("^"),f+=e.substr(t,s.lastIndex-t),o=new Error;for(a in i={message:""+n+"\n\nLine "+h+":\n"+f+"\n"+u+r,error:n,line:h,"char":u.length,tag:l})o[a]=i[a];return o};while(m=S.exec(e)){O=m.slice(1,3),l=O[0],k=O[1],C=m[3]||m[5]||m[7]||m[9],E=m[4]||m[6]||m[8]||m[10],c=b+l.length-1,b=S.lastIndex,v=(c===-1||e.charAt(c)==="\n")&&((M=e.charAt(b))===void 0||M===""||M==="\r"||M==="\n"),l&&i.push(function(e){return function(){return e}}(l)),v&&C!==""&&C!=="&"&&C!=="{"?(e.charAt(b)==="\r"&&(b+=1),e.charAt(b)==="\n"&&(b+=1)):k&&(i.push(function(e){return function(){return e}}(k)),c+=k.length,k="");switch(C){case"!":break;case"":case"&":case"{":s=function(e,t){return function(n){var r,i;return(r=(i=N(e,n))!=null?i:"")instanceof Function&&(r=T.apply(null,[this,A(""+r())].concat(R.call(arguments)))),t||(r=this.escape(""+r)),""+r}},i.push(s(E,C));break;case">":u=function(e,t){return function(n,r){var i;return i=r(e).toString(),t&&(i=i.replace(/^(?=.)/gm,t)),T.apply(null,[this,A(i)].concat(R.call(arguments)))}},i.push(u(E,k));break;case"#":case"^":w={name:E,start:b,error:y(S.lastIndex,"Unclosed section '"+E+"'!")},_=A(e,t,w),x=_[0],b=_[1],w["#"]=a=function(e,t,n){return function(r){var i,s,o,u;return u=N(e,r)||[],x=u instanceof Function?u(n):n,u instanceof Array||(u=[u]),i=A(x||"",t),r.push(u),s=function(){var e,t,n;n=[];for(e=0,t=u.length;e<t;e++)o=u[e],r[r.length-1]=o,n.push(T.apply(null,[this,i].concat(R.call(arguments))));return n}.apply(this,arguments),r.pop(),s.join("")}},w["^"]=o=function(e,t,n){return function(r){var i;return i=N(e,r)||[],i instanceof Array||(i=[1]),i=i.length===0?A(n,t):[],T.apply(null,[this,i].concat(R.call(arguments)))}},i.push(w[C](E,t,x));break;case"/":n==null?p="End Section tag '"+E+"' found, but not in section!":E!==(g=n.name)&&(p="End Section tag closes '"+E+"'; expected '"+g+"'!");if(p)throw y(S.lastIndex,p);return e=e.slice(n.start,c+1||9e9),f[e]=i,[e,b];case"=":(t=E.split(/\s+/)).length!==2&&(p="Set Delimiters tags should have two and only two values!");if(p)throw y(S.lastIndex,p);d=/[-[\]{}()*+?.,\\^$|#]/g,t=function(){var e,n,r;r=[];for(e=0,n=t.length;e<n;e++)h=t[e],r.push(h.replace(d,"\\$&"));return r}(),S=r();break;default:throw y(S.lastIndex,"Unknown tag type -- "+C)}S.lastIndex=b!=null?b:e.length}if(n!=null)throw n.error;return e.length!==b&&i.push(function(){return e.slice(b)}),f[e]=i},C={VERSION:"1.2.0",helpers:[],partials:null,escape:function(e){var t;return t={"&":"amp",'"':"quot","<":"lt",">":"gt"},e.replace(/[&"<>]/g,function(e){return"&"+t[e]+";"})},render:function(e,t,n){var r;return n==null&&(n=null),(n||(n=this.partials||{}))instanceof Function||(n=function(e){return function(t){if(t in e)return N(t,[e]);throw"Unknown partial '"+t+"'!"}}(n)),r=this.helpers instanceof Array?this.helpers:[this.helpers],T(this,A(e),r.concat([t]),n)}},this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes=[],this.__apptools_preinit.deferred_core_modules=[],this.__apptools_preinit.abstract_feature_interfaces=[],this.__apptools_preinit.deferred_library_integrations=[]):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[],abstract_feature_interfaces:[],deferred_library_integrations:[]},u=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(u),v=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(v),p=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(p),h=function(e){function t(e,t,n){this.module=e,this.message=t,this.context=n}return z(t,e),t.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message},t}(Error),this.__apptools_preinit.abstract_base_classes.push(h),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t.prototype.toString=function(){return"["+this.module+"] AppException: "+this.message},t}(h),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t.prototype.toString=function(){return"["+this.module+"] AppToolsException: "+this.message},t}(h),this.__apptools_preinit.abstract_base_classes.push(e),this.__apptools_preinit.abstract_base_classes.push(r),this.Backbone!=null?(o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t}(Backbone.View),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t}(Backbone.Model),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t}(Backbone.Router),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t}(Backbone.Collection)):(o=function(){function e(){}return e}(),i=function(){function e(){}return e}(),s=function(){function e(){}return e}(),n=function(){function e(){}return e}()),this.__apptools_preinit.abstract_base_classes.push(o),this.__apptools_preinit.abstract_base_classes.push(i),this.__apptools_preinit.abstract_base_classes.push(s),this.__apptools_preinit.abstract_base_classes.push(n),q=function(){function t(){return this.wrap=W(this.wrap,this),this.to_rgb=W(this.to_rgb,this),this.to_hex=W(this.to_hex,this),this.extend=W(this.extend,this),this.prep_animation=W(this.prep_animation,this),this.timestamp=W(this.timestamp,this),this.now=W(this.now,this),this.block=W(this.block,this),this.unbind=W(this.unbind,this),this.bind=W(this.bind,this),this.is_id=W(this.is_id,this),this.has_class=W(this.has_class,this),this.get_offset=W(this.get_offset,this),this.get=W(this.get,this),this.in_array=W(this.in_array,this),this.is_empty_object=W(this.is_empty_object,this),this.is_raw_object=W(this.is_raw_object,this),this.is_object=W(this.is_object,this),this.is_function=W(this.is_function,this),this.is=W(this.is,this),this}var e=this;return t.mount="util",t.events=[],t.prototype.is=function(e){return!this.in_array(e,[!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])},t.prototype.is_function=function(e){return typeof e=="function"},t.prototype.is_object=function(e){return typeof e=="object"},t.prototype.is_raw_object=function(e){return!e||typeof e!="object"||e.nodeType||typeof e=="object"&&X.call(e,"setInterval")>=0?!1:e.constructor!=null&&!e.hasOwnProperty("constructor")&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},t.prototype.is_empty_object=function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)return t=e[n],!1;return!0},t.prototype.is_array=Array.isArray||function(e){return typeof e=="array"||Object.prototype.toString.call(e)==="[object Array]"},t.prototype.in_array=function(e,t){var n,r,i,s,o,u=this;if(t.indexOf!=null)return!!~t.indexOf(e);r=[],i=function(t){if(t===e)return r.push(t)};for(s=0,o=t.length;s<o;s++)n=t[s],i(n);return r.length>0},t.prototype.get=function(e,t){return t==null&&(t=document),document.getElementById(e)||t.getElementsByClassName(e)||t.getElementsByTagName(e)||!1},t.prototype.get_offset=function(e){var t,n;t=n=0;for(;;){t+=e.offsetLeft,n+=e.offsetTop;if(!(e=e.offsetParent))break}return{left:t,top:n}},t.prototype.has_class=function(e,t){var n;return((n=e.classList)!=null?typeof n.contains=="function"?n.contains(t):void 0:void 0)||e.className&&(new RegExp("\\s*"+t+"\\s*")).test(e.className)},t.prototype.is_id=function(e){return e.charAt(0)==="#"||document.getElementById(e!==null)?!0:!1},t.prototype.bind=function(e,t,n,r){var i,s,o,u,a,f;r==null&&(r=!1);if(this.is_array(e)){console.log("[Util]: Binding multiple trigger elements for "+t+" event.");for(a=0,f=e.length;a<f;a++)return s=e[a],this.bind(s,t,n,r)}if(this.is_raw_object(t))for(o in t)return u=t[o],this.bind(e,o,u,r);return console.log("[Util]: Binding "+n+" function to "+t+" event on "+(i=e.getAttribute("id")?e.getAttribute("id"):e.className)+"."),e.addEventListener(t,n,r)},t.prototype.unbind=function(e,t){return e.removeEventListener(t)},t.prototype.block=function(e,t){var n,r;t==null&&(t={}),console.log("[Util]: Enforcing blocking at user request... :("),r=!1,n=null,e(t,function(e){return n=e,r=!0});for(;;)if(r!==!1)break;return n},t.prototype.now=function(){return new Date},t.prototype.timestamp=function(e){return e==null&&(e=new Date),[[e.getMonth()+1,e.getDate(),e.getFullYear()].join("-"),[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")].join(" ")},t.prototype.prep_animation=function(e,t,n){var r;return r=e!=null&&this.is_object(e)?this.extend({},e):{complete:n||!n&&t||is_function(e&&e),duration:e,easing:n&&t||t&&!is_function(t)},r},t.prototype.extend=function(){var e,t,n,r,i,s,o,u,a,f=this;s=arguments[0]||{},r=1,n=!1,i=arguments.length,typeof s=="boolean"&&(n=s,s=arguments[1]||{},r++),!this.is_object(s)&&!this.is_function(s)&&(s={}),t=Array.prototype.slice.call(arguments,r),o=function(e){var t,r,i,o,u,a,l,c,h;a=e,h=[];for(u in a){c=a[u];if(s===c)continue;o=String(u),r=c,l=s[u],n&&r!=null&&(f.is_raw_object(r)||(t=f.is_array(r)))?(t!=null?(t=!1,i=l&&(f.is_array(l)?l:[])):i=l&&(f.is_raw_object(l)?l:{}),h.push(s[u]=f.extend(n,i,r))):r!=null?h.push(s[u]=r):h.push(void 0)}return h};for(u=0,a=t.length;u<a;u++)e=t[u],o(e);return s},t.prototype.to_hex=function(e){var t,n,r,i,s,o=this;if(e.match(/^#?[0-9A-F]{6}|[0-9A-F]{3}$\/i/))return e.charAt(!1)?e:"#"+e;if(!e.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/))return!1;n=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],s=function(e){if(e.length<2)return e="0"+e};if(n.length===3)return i=s(n[0].toString(16)),r=s(n[1].toString(16)),t=s(n[2].toString(16)),"#"+i+r+t},t.prototype.to_rgb=function(e){var t,n,r,i;return e.match(/^rgb\(\s*\d{1,3}\s*,\s\d{1,3}\s*,\s*\d{1,3}\s*\)$/)?e:e.match(/^#?([0-9A-F]{1,2})([0-9A-F]{1,2})([0-9A-F]{1,2})$\/i/)?(n=[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],i=n[0].toString(10),r=n[1].toString(10),t=n[2].toString(10),"rgb("+i+","+r+","+t+")"):!1},t.prototype.wrap=function(e,t){var n,r=this;return e.preventDefault!=null?(e.preventDefault(),e.stopPropagation()):t=e,n=Array.prototype.slice.call(arguments,1),function(){return t.apply(r,n)}},t._init=function(){},t}.call(this),this.__apptools_preinit.abstract_base_classes.push(q),this.__apptools_preinit.deferred_core_modules.push({module:q}),q=window.Util=new q,f=function(e){function t(e,t){var n=this;this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0,serverside:!1},this.setDebug=function(e){return n.debug=e,n._sendLog("[CoreDev] Debug has been set.",n.debug)},this._sendLog=function(){var e;return e=1<=arguments.length?R.call(arguments,0):[],console.log.apply(console,e)},this.log=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?R.call(arguments,2):[],e==null&&(e="{no context}"),n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] INFO: "+t].concat(R.call(e)))},this.warning=this.warn=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?R.call(arguments,2):[],e==null&&(e="{no context}"),n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] WARNING: "+t].concat(R.call(e)))},this.error=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?R.call(arguments,2):[],n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] ERROR: "+t].concat(R.call(e)))},this.verbose=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?R.call(arguments,2):[],n.debug.verbose===!0&&n._sendLog.apply(n,["["+r+"] DEBUG: "+t].concat(R.call(e)))},this.exception=this.critical=function(){var e,r,i,s;throw s=arguments[0],i=arguments[1],r=arguments[2],e=4<=arguments.length?R.call(arguments,3):[],r==null&&(r=t.AppToolsException),n._sendLog("A critical error or unhandled exception occurred."),n._sendLog.apply(n,["["+s+"] CRITICAL: "+i].concat(R.call(e))),new r(s,i,e)}}return z(t,e),t.mount="dev",t.events=[],t}(u),this.__apptools_preinit.abstract_base_classes.push(f),d=function(e){function t(e,t){}return z(t,e),t.mount="model",t.events=[],t}(u),this.__apptools_preinit.abstract_base_classes.push(d),c=function(e){function t(e,t){var n=this;this.registry=[],this.callchain={},this.history=[],this.fire=this.trigger=function(){var t,r,i,s,o,u,a,f,l,c,h,p,d,v;s=arguments[0],t=2<=arguments.length?R.call(arguments,1):[],e.dev.verbose("Events","Triggered event:",s,t,n.callchain[s]);if(X.call(n.registry,s)>=0){a=0,u=0,o=[],l=[],l.push(s),v=n.callchain[s].hooks;for(c=0,p=v.length;c<p;c++){i=v[c];try{if(i.once===!0&&i.has_run===!0)continue;i.bridge!=null==0?(f=i.fn.apply(i,t),a++,n.history.push({event:s,callback:i,args:t,result:f}),i.has_run=!0):i.bridge===!0&&o.push({event:i.event,args:t})}catch(m){u++,n.history.push({event:s,callback:i,args:t,error:m})}}for(h=0,d=o.length;h<d;h++)r=o[h],l.push(r.event),n.trigger.apply(n,[r.event].concat(R.call(r.args)));return{events:l,executed:a,errors:u}}return!1},this.create=this.register=function(t){var r,i,s;t instanceof Array||(t=[t]);for(i=0,s=t.length;i<s;i++)r=t[i],n.registry.push.apply(n.registry,t),n.callchain[r]={hooks:[]};return e.dev.verbose("Events","Registered events:",{count:t.length,events:t}),!0},this.on=this.upon=this.when=this.hook=function(t,r,i){return i==null&&(i=!1),X.call(n.registry,t)<0&&(e.dev.warning("Events",""),n.register(t)),n.callchain[t].hooks.push({fn:r,once:i,has_run:!1,bridge:!1}),e.dev.verbose("Events","Hook registered on event.",t),!0},this.delegate=this.bridge=function(t,r){var i,s,o,u,a;typeof r=="string"&&(r=[r]),typeof t=="string"&&(t=[t]),a=[];for(o=0,u=t.length;o<u;o++)i=t[o],a.push(function(){var t,n,o;o=[];for(t=0,n=r.length;t<n;t++)s=r[t],e.dev.verbose("Events","Bridging events:",i,"->",s),this.callchain[i]==null&&(e.dev.warn("Events","Bridging from undefined source event:",i),this.register(i)),o.push(this.callchain[i].hooks.push({event:s,bridge:!0}));return o}.call(n));return a}}return z(t,e),t.mount="events",t.events=[],t}(u),this.__apptools_preinit.abstract_base_classes.push(c),a=function(e){function t(e,t){this._data={},this.platform={},this.capabilities={},e.lib.modernizr!=null&&(this.capabilities=e.lib.modernizr),this.capabilities.simple={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:t.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return z(t,e),t.mount="agent",t.events=["UA_DISCOVER"],t.prototype._makeMatch=function(e){var t,n,r,i,s;for(i=0,s=e.length;i<s;i++){r=e[i],n=r.string,t=r.prop,this._data.versionSearchString=r.versionSearch||r.identity;if(n!==null){if(r.string.indexOf(r.subString)!==-1)return r.identity}else if(t)return r.identity}},t.prototype._makeVersion=function(e){var t;t=e.indexOf(this._data.versionSearchString);if(t!==-1)return parseFloat(e.substring(t+this._data.versionSearchString.length+1))},t.prototype.discover=function(){var e,t,n,r,i;e=this._makeMatch(this._data.browsers)||"unknown",i=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",n=this._makeMatch(this._data.os)||"unknown";if(e==="iPod/iPhone"||e==="Android")r="mobile",t=!1;this.platform={os:n,type:r,vendor:navigator.vendor,product:navigator.product,browser:e,version:i,flags:{online:navigator.onLine||!0,mobile:t,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple.cookies=navigator.cookieEnabled;if(window.jQuery!=null)return this.capabilities.simple.ajax=$.support.ajax},t}(u),this.__apptools_preinit.abstract_base_classes.push(a),l=function(e){function t(e,t){var n=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return n.state.opened=!0,e.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(t,r,i){return n.state.pending[t]={request:r,callbacks:callbacks,xhr:i},e.dev.verbose("Dispatch","Received EXPECT signal.",t,r,callbacks,i)},this.receive=function(t){var r,i,s,o,u;try{i=JSON.parse(t.data)}catch(a){i=t.data}return e.dev.verbose("Dispatch","Parsed async message.",i),n.state.history.received.push(t),i.status==="ok"?(e.dev.verbose("Dispatch","Triggering deferred success callback."),n.state.complete[i.id]=n.state.pending[i.id],n.state.complete[i.id].response=i,delete n.state.pending[i.id],e.dev.log("RPC","Success",t.data,i.status,n.state.complete[i.id].xhr),e.api.rpc.lastResponse=t.data,e.api.rpc.history[i.id].xhr=n.state.complete[i.id].xhr,e.api.rpc.history[i.id].status=i.status,e.api.rpc.history[i.id].response=t.data,r={xhr:n.state.complete[i.id].xhr,status:i.status,data:t.data},e.events.trigger("RPC_SUCCESS",r),typeof (s=n.state.complete[i.id].callbacks).success=="function"?s.success(i.response.content):void 0):i.status==="notify"?(e.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (o=n.state.pending[i.id].callbacks).notify=="function"?o.notify(i.response.content):void 0):(e.dev.error("Dispatch","Userland deferred task error. Calling error callback.",i),typeof (u=n.state.pending[i.id].callbacks).error=="function"?u.error(i.content):void 0)},this.error=function(t){return n.state.error=!0,n.history.errors.push(t),e.dev.error("Dispatch","Dispatch error state triggered.",t)},this.close=function(){return n.state.opened=!1,n.state.receiving=!1,e.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return z(t,e),t.mount="dispatch",t.events=[],t}(u),this.__apptools_preinit.abstract_base_classes.push(l),w=function(e){function t(e,t){var n=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},adapters:{},obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(e){},bootstrap:function(e){},provision_collection:function(e,t,n){}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this._init=function(){return e.dev.verbose("Storage","Storage support is currently stubbed."),e.events.trigger("STORAGE_INIT"),e.events.trigger("STORAGE_READY")},e.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),e.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return z(t,e),t.mount="storage",t.events=["STORAGE_INIT","STORAGE_READY","STORAGE_ERROR","STORAGE_ACTIVITY","STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE","COLLECTION_SCAN","COLLECTION_CREATE","COLLECTION_DESTROY","COLLECTION_UPDATE","COLLECTION_SYNC"],t}(u),F=function(e){function t(){return}return z(t,e),t.methods=[],t["export"]="private",t}(p),this.__apptools_preinit.abstract_base_classes.push(F),this.__apptools_preinit.abstract_base_classes.push(w),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:F,name:"storage"}),D=function(e){function t(e,t,n,r){var i,s,o,u;this.name=e,this.base_uri=t,this.methods=n,this.config=r;if(this.methods.length>0){u=this.methods;for(s=0,o=u.length;s<o;s++)i=u[s],this[i]=this._buildRPCMethod(i,t,r)}}return z(t,e),t.prototype._buildRPCMethod=function(e,t,n){var r,i,s=this;return r=this.name,i=function(t,n,i,s,o,u){return t==null&&(t={}),n==null&&(n=null),i==null&&(i=!1),s==null&&(s=!1),o==null&&(o={}),u==null&&(u={}),function(t,n,i,s,o){var a;return a=$.apptools.api.rpc.createRPCRequest({method:e,api:r,params:t||{},opts:o||{},async:i||!1,push:s||!1}),n!==null?a.fulfill(n,u):a}(t,n,i,s,o)},$.apptools.api.registerAPIMethod(r,e,t,n),i},t}(v),H=function(e){function t(e,t,n){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accepts:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},e!=null&&(this.envelope.id=e),t!=null&&(this.envelope.opts=t),n!=null&&(this.envelope.agent=n)}return z(t,e),t.prototype.fulfill=function(e,t){var n,r,i=this;return e==null&&(e={}),(e!=null?e.success:void 0)==null&&(r=function(e,t,n){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",i,e,t,n)},e.success=r),(e!=null?e.failure:void 0)==null&&(n=function(e){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",i,e)},e.failure=n),$.apptools.api.rpc.fulfillRPCRequest(t,this,e)},t.prototype.setAsync=function(e){var t,n;return(t=this.ajax)!=null&&(n=t.async)==null&&(t.async=e),this},t.prototype.setPush=function(e){return e===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},t.prototype.setOpts=function(e){var t,n;return(t=this.envelope)!=null&&(t.opts=_.defaults(e,(n=this.envelope)!=null?n.opts:void 0)),this},t.prototype.setAgent=function(e){var t,n;return(t=this.envelope)!=null&&(n=t.agent)==null&&(t.agent=e),this},t.prototype.setAction=function(e){return this.action=e,this},t.prototype.setMethod=function(e){return this.method=e,this},t.prototype.setAPI=function(e){return this.api=e,this},t.prototype.setBaseURI=function(e){return this.base_uri=e,this},t.prototype.setParams=function(e){return this.params=e!=null?e:{},this},t.prototype.payload=function(){var e;return e={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},e},t}(v),B=function(e){function t(){var e;e=1<=arguments.length?R.call(arguments,0):[],$.apptools.dev.verbose("RPC","RPCResponse is not yet implemented and is currently stubbed.");return}return z(t,e),t}(v),y=function(e){function n(e,n){var r,i,s,o=this;this.state={sockets:{token:"__NULL__",enabled:!1,status:"DISCONNECTED","default":null,default_host:((i=e.config)!=null?(s=i.rpc)!=null?s.socket_host:void 0:void 0)!=null||null}},this.base_rpc_uri=e.config.rpc.base_uri||"/_api/rpc",this.socket_host=e.config.rpc.socket_host||null,e.sys.libraries.resolve("jQuery")!==!1?r=$.ajaxSettings.xhr:r=new XMLHTTPRequest,this.internals={transports:{xhr:{factory:function(){var t;return t=r(),t&&typeof t.addEventListener=="function"&&t.addEventListener("progress",function(t){return e.events.trigger("RPC_PROGRESS",{event:t})},!1),t}},websocket:{factory:function(){var t,n,r,i,s,u;if(e.agent.capabilities.websockets==null)throw e.dev.error("RPC","Socket factory can't produce a socket because the client platform does not support WebSockets."),"SocketsNotSupported: The client platform does not have support for websockets.";if(((r=o.state.sockets)!=null?r.enabled:void 0)!=null==1)return((i=o.state.sockets)!=null?i["default"]:void 0)!=null===null&&((s=o.state.sockets)!=null?(u=s.open)!=null?u.length:void 0:void 0)===0&&(n=new e.push.socket.establish,o.state.sockets.enabled=!0,o.state.sockets["default"]=n,o.state.sockets.status="CONNECTED"),t={},t}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[t.version.major.toString(),t.version.minor.toString(),t.version.micro.toString(),t.version.build.toString()].join("."),"-",t.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},e.sys.libraries.resolve("jQuery")!==!1&&$.ajaxSetup({global:!0,xhr:function(){return o.internals.transports.xhr.factory()},headers:this.internals.config.headers}),this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,history:{},action_prefix:null,alt_push_response:!1,used_ids:[],factory:function(t,n,r,i){return e.api[t]=new D(t,n,r,i)},_assembleRPCURL:function(e,t,n,r){if(t==null&&r==null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return t!=null?r!=null?r=r+"/"+t:r=o.base_rpc_uri+"/"+t:r==null&&(r=o.base_rpc_uri),n!==null?[n+r,e].join("."):[r,e].join(".")},provisionRequestID:function(){var e;return o.rpc.used_ids.length>0?(e=Math.max.apply(o,o.rpc.used_ids)+1,o.rpc.used_ids.push(e),e):(o.rpc.used_ids.push(1),1)},decodeRPCResponse:function(e,t,n,r,i){return r(e,t)},createRPCRequest:function(t){var n;return n=new H(o.rpc.provisionRequestID()),t.api!=null&&n.setAPI(t.api),t.method!=null&&n.setMethod(t.method),t.agent!=null&&n.setAgent(t.agent),t.opts!=null&&n.setOpts(t.opts),t.base_uri!=null&&n.setBaseURI(t.base_uri),t.params!=null&&n.setParams(t.params),t.async!=null&&n.setAsync(t.async),t.push!=null?n.setPush(t.push):n.setPush(o.rpc.alt_push_response),e.dev.verbose("RPC","New Request",n,t),n.setAction(o.rpc._assembleRPCURL(n.method,n.api,o.rpc.action_prefix,o.base_rpc_uri)),n},fulfillRPCRequest:function(t,n,r,i){var s;i==null&&(i="xhr"),e.dev.verbose("RPC","Fulfill",t,n,r),o.rpc.lastRequest=n,o.rpc.history[n.envelope.id]={request:n,config:t,callbacks:r};if(n.action===null){if(n.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(n.base_uri===null){if(n.api===null)throw"[RPC] Error: Request must have an API or explicity defined BASE_URI.";n.action=o.rpc._assembleRPCURL(n.method,n.api,o.rpc.action_prefix)}else n.action=o.rpc._assembleRPCURL(n.method,null,o.rpc.action_prefix,n.base_uri)}if(n.action===null||n.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return s={config:t,request:n,callbacks:r},e.events.trigger("RPC_FULFILL",s),function(e,t,n){var r,i,o,u,a=this;u={resourceId:t.api+"."+t.method,url:t.action,data:JSON.stringify(t.payload()),async:t.ajax.async,global:t.ajax.global,type:t.ajax.http_method||"POST",accepts:t.ajax.accepts||"application/json",crossDomain:t.ajax.crossDomain,dataType:t.ajax.dataType,processData:!1,ifModified:t.ajax.ifModified,contentType:t.ajax.contentType,beforeSend:function(r,i){return e.api.rpc.history[t.envelope.id].xhr=r,n!=null&&typeof n.status=="function"&&n.status("beforeSend"),r},error:function(r,i,o){return n!=null&&typeof n.status=="function"&&n.status("error"),e.dev.error("RPC","Error: ",{error:o,status:i,xhr:r}),e.api.rpc.lastFailure=o,e.api.rpc.history[t.envelope.id].xhr=r,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].failure=o,s={xhr:r,status:i,error:o},e.events.trigger("RPC_ERROR",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.failure=="function"?n.failure(o):void 0:void 0},success:function(r,i,o){return r.status==="ok"?(n!=null&&typeof n.status=="function"&&n.status("success"),e.dev.log("RPC","Success",r,i,o),e.api.rpc.lastResponse=r,e.api.rpc.history[t.envelope.id].xhr=o,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].response=r,s={xhr:o,status:i,data:r},e.events.trigger("RPC_SUCCESS",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.success=="function"?n.success(r.response.content,r.response.type,r):void 0:void 0):r.status==="wait"?(n!=null&&typeof n.status=="function"&&n.status("wait"),e.dev.log("RPC","PushWait",r,i,o),s={xhr:o,status:i,data:r},n!=null&&typeof n.wait=="function"&&n.wait(r,i,o),e.push.internal.expect(t.envelope.id,t,o)):r.status==="fail"?(n!=null&&typeof n.status=="function"&&n.status("error"),e.dev.error("RPC","Error: ",{error:r,status:i,xhr:o}),e.api.rpc.lastFailure=r,e.api.rpc.history[t.envelope.id].xhr=o,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].failure=r,s={xhr:o,status:i,error:r},e.events.trigger("RPC_ERROR",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.failure=="function"?n.failure(r):void 0:void 0):n!=null?typeof n.success=="function"?n.success(r.response.content,r.response.type,r):void 0:void 0},statusCode:{404:function(){return e.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),e.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return e.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),e.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return e.dev.error("RPC","HTTP/500","Internal server error."),e.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},r=e.sys.drivers.resolve("transport");if(r.name==="amplify")e.dev.verbose("RPC","Fulfilling with AmplifyJS transport adapter."),o=r.driver.request,i=o(u);else{if(r.name!=="jquery")throw e.dev.error("RPC","Native RPC adapter is currently stubbed."),"[RPC]: No valid AJAX transport adapter found.";e.dev.verbose("RPC","Fulfilling with jQuery AJAX transport adapter.",u),i=jQuery.ajax(u.url,u)}return e.dev.verbose("RPC","Resulting XHR: ",i)}(e,n,r),{id:n.envelope.id,request:n}}},this.ext=null,this.registerAPIMethod=function(t,n,r,i){var s,u,a,f;if(e!=null?(f=e.sys)!=null?f.drivers:void 0:void 0){s=e.sys.drivers.resolve("transport","amplify");if(s!==!1)return e.dev.log("RPCAPI",'Registering request procedure "'+t+"."+n+'" with AmplifyJS.'),a=t+"."+n,u={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:o.rpc._assembleRPCURL(n,t,null,r),decoder:o.rpc.decodeRPCResponse},i.caching!=null?(i.caching===!0&&(u.caching="persist"),s.request.define(a,"ajax",u)):s.request.define(a,"ajax",u)}}}return z(n,e),n.mount="api",n.events=["RPC_CREATE","RPC_FULFILL","RPC_SUCCESS","RPC_ERROR","RPC_COMPLETE","RPC_PROGRESS"],n}(u),P=function(e){function t(){return}return z(t,e),t.methods=[],t["export"]="private",t}(p),this.__apptools_preinit.abstract_base_classes.push(D),this.__apptools_preinit.abstract_base_classes.push(P),this.__apptools_preinit.abstract_base_classes.push(y),this.__apptools_preinit.abstract_base_classes.push(H),this.__apptools_preinit.abstract_base_classes.push(B),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:P,name:"transport"}),E=function(e){function t(e,t){this.current_user=null}return z(t,e),t.mount="user",t.events=["SET_USER_INFO"],t.prototype.setUserInfo=function(e){return this.current_user=e.current_user||null,$.apptools.dev.log("UserAPI","Set server-injected userinfo: "
,this.current_user),$.apptools.events.trigger("SET_USER_INFO",this.current_user)},t}(u),this.__apptools_preinit.abstract_base_classes.push(E),g=function(e){function t(e,t){var n=this;this.state={ready:!1,status:"init",transport:{sockets:[],channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},e.events.bridge(["PUSH_READY","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_OPEN","PUSH_SOCKET_CLOSE"],"PUSH_STATE_CHANGE"),e.events.hook("PUSH_SOCKET_OPEN",function(){var t;return t=1<=arguments.length?R.call(arguments,0):[],e.api.rpc.alt_push_response=!0}),e.events.hook("PUSH_SOCKET_CLOSE",function(){var t;return t=1<=arguments.length?R.call(arguments,0):[],e.api.rpc.alt_push_response=!1}),this.events={on_open:function(t){if(n.state.transport.sockets.length=0)n.state.status="ready";return e.events.trigger("PUSH_SOCKET_OPEN",n.state),e.dev.verbose("PushSocket","Message transport opened.")},on_message:function(t,r){var i;return n.state.status="receiving",e.dev.verbose("PushSocket","Message received.",r),e.events.trigger("PUSH_SOCKET_ACTIVITY",n.state),typeof (i=n.state.callbacks).activity=="function"&&i.activity(r),e.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",n.state)},on_error:function(t,r){return n.state.status="error",e.dev.error("PushSocket","Message transport error.",r),e.events.trigger("PUSH_SOCKET_ERROR",n.state)},on_close:function(t){return n.state.ready=!1,n.state.status="close",e.dev.verbose("PushSocket","Message transport closed."),e.events.trigger("PUSH_SOCKET_CLOSE",n.state)}},this.internal={open_channel:function(t){return e.events.trigger("PUSH_INIT",{token:t,type:"channel"}),n.state.config.token=t,n.state.transport.channel=new goog.appengine.Channel(n.state.config.token),n.internal._add_socket(n.state.transport.channel)},open_websocket:function(t,r){return e.events.trigger("PUSH_INIT",{token:t,server:r,type:"websocket"}),e.dev.log("Push","WARNING: WebSockets support is currently experimental."),n.internal._add_socket(n.state.transport.socket)},_add_socket:function(t,r){var i;return i=t.open(),n.state.transport.sockets.push(i),e.events.trigger("PUSH_SOCKET_ESTABLISH",i),i.onopen=function(){var e,t;return e=1<=arguments.length?R.call(arguments,0):[],(t=n.events).on_open.apply(t,[i].concat(R.call(e)))},i.onmessage=function(){var e,t;return e=1<=arguments.length?R.call(arguments,0):[],(t=n.events).on_message.apply(t,[i].concat(R.call(e)))},i.onerror=function(){var e,t;return e=1<=arguments.length?R.call(arguments,0):[],(t=n.events).on_error.apply(t,[i].concat(R.call(e)))},i.onclose=function(){var e,t;return e=1<=arguments.length?R.call(arguments,0):[],(t=n.events).on_close.apply(t,[i].concat(R.call(e)))},n.internal},expect:function(e,t,r){var i,s;return(i=n.state)!=null&&(s=i.callbacks)!=null&&typeof s.expect=="function"&&s.expect(e,t,r),n.internal}},this.channel={establish:function(e){return n.internal.open_channel(e)}},this.socket={establish:function(t,r){return r==null&&(r=null),n.internal.open_websocket(t,r||e.config.sockets.host)}},this.listen=function(e){return n.state.callbacks=_.defaults(e,n.state.callbacks),n.state.ready=!0,n.internal}}return z(t,e),t.mount="push",t.events=["PUSH_INIT","PUSH_READY","PUSH_STATE_CHANGE","PUSH_SOCKET_OPEN","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ACTIVITY","PUSH_SOCKET_ACTIVITY_FINISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_CLOSE"],t}(u),O=function(e){function t(){return}return z(t,e),t.methods=[],t["export"]="private",t}(p),this.__apptools_preinit.abstract_base_classes.push(O),this.__apptools_preinit.abstract_base_classes.push(g),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:O,name:"transport"}),b=function(e){function t(e,t){return}return z(t,e),t.mount="render",t.events=["ADD_TEMPLATE","RENDER_TEMPLATE"],t["export"]="private",t.prototype._init=function(){},t}(u),j=function(e){function t(){return}return z(t,e),t["export"]="private",t.methods=["render","register_template"],t}(p),M=function(e){function t(){return}return z(t,e),t["export"]="private",t.methods=["element_by_id","elements_by_class"],t}(p),this.__apptools_preinit.abstract_base_classes.push(M),this.__apptools_preinit.abstract_base_classes.push(j),this.__apptools_preinit.abstract_base_classes.push(b),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:j,name:"render"}),x=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t.mount="widget",t.events=[],t.prototype._init=function(e){e.sys.state.add_flag("widgets"),e.dev.verbose("CoreWidget","Widget functionality is currently stubbed.")},t}(u),S=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return z(t,e),t.prototype.animation={duration:400,easing:null,complete:null},t.prototype.prepare_overlay=function(e){var t,n;return e==null&&(e="apptools"),n=document.createElement("div"),n.className="fixed overlay",n.setAttribute("id",e+"-overlay-"+(t=Math.floor(Math.random()*1e3))),n.setAttribute("data-overlay-id",t),n.style.opacity=0,n},t}(v),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(S),this.__apptools_preinit.abstract_base_classes.push(x),this.__apptools_preinit.deferred_core_modules.push({module:x}),L=function(e){function t(e,t,n){var r=this;this._state={modals:[],modals_by_id:{},next:0,init:!1},this.create=function(e,t,n){var i;return n==null&&(n={}),i=new k(e,t,n),r._state.modals_by_id[i._state.element_id]=r._state.next,r._state.modals.push(i),r._state.next++,i._init()},this.destroy=function(e){var t;return t=e._state.element_id,r._state.modals.splice(r._state.modals_by_id[t],1),delete r._state.modals_by_id[t],document.body.removeChild(q.get(t)),e},this.enable=function(e){var t;return t=q.get(e._state.trigger_id),console.log("TRIGGER: "+t.getAttribute("id")),q.bind(t,"mousedown",e.open,!1),e},this.disable=function(e){return q.unbind(q.get(e._state.trigger_id)),e},this._init=function(){var e,t,n,i;t=q.get("pre-modal");for(n=0,i=t.length;n<i;n++)e=t[n],r.enable(r.create(e,q.get("a-"+e.getAttribute("id"))));return r._state.init=!0}}return z(t,e),t.mount="modal",t.events=["MODAL_READY","MODAL_API_READY"],t}(x),k=function(e){function t(e,t){var n=this;this._state={cached_id:e.getAttribute("id"),trigger_id:t.getAttribute("id"),element_id:null,overlay_id:null,active:!1,init:!1,config:{initial:{width:"0px",height:"0px",top:window.innerHeight/2+"px",left:window.innerHeight/2+"px"},ratio:{x:.4,y:.4},template:['<div id="modal-dialog" style="opacity: 0;" class="fixed dropshadow modal">','<div id="modal-fade" style="opacity: 0">','<div id="modal-content">&nbsp;</div>','<span class="modal-ui" class="absolute">','<span id="modal-title" class="absolute"></span>','<span id="modal-close" class="absolute">X</span>',"</span>","</div>","</div>"].join("\n"),rounded:!0}},this._state.config=q.extend(!0,this._state.config,JSON.parse(e.getAttribute("data-options"))),this.calc=function(){var e,t,r,i,s,o;return e={},i=n._state.config.ratio,o=window.innerWidth,s=window.innerHeight,r=Math.floor(i.x*o),t=Math.floor(i.y*s),e.width=r+"px",e.height=t+"px",e.left=Math.floor((o-r)/2),e.top=Math.floor((s-t)/2),e},this.make=function(){var t,r,i,s,o,u,a,f,l,c,h,p,d;c=n._state.config.template,l=document.createRange(),l.selectNode(o=document.getElementsByTagName("div").item(0)),i=l.createContextualFragment(c),document.body.appendChild(i),s=q.get("modal-dialog"),h=q.get("modal-title"),r=q.get("modal-content"),t=q.get("modal-close"),u=q.get("modal-fade"),a=n._state.cached_id,s.setAttribute("id","modal-dialog-"+a),n._state.config.rounded&&s.classList.add("rounded"),d=n._state.config.initial;for(f in d)p=d[f],s.style[f]=p;return r.setAttribute("id","modal-content-"+a),r.style.height=n.calc().height,r.innerHTML=e.innerHTML,h.setAttribute("id","modal-title-"+a),h.innerHTML=e.getAttribute("data-title"),t.setAttribute("id","modal-close-"+a),u.setAttribute("id","modal-fade-"+a),n._state.element_id=s.getAttribute("id"),s},this.open=function(){var e,t,r,i,s;return e=q.get(n._state.element_id),n._state.active=!0,i=n.prepare_overlay("modal"),n._state.overlay_id=i.getAttribute("id"),document.body.appendChild(i),t=s=n.animation,t.complete=function(){var e;return q.bind(e=q.get("modal-close-"+n._state.cached_id),"mousedown",n.close)},s.complete=function(){return q.bind(i,"mousedown",n.close)},r=n.calc(),r.opacity=1,console.log("FINAL: "+r),$(i).animate({opacity:.5},s),$(e).animate(r,t),e},this.close=function(){var e,t,r,i,s,o,u;return n._state.active=!1,o=q.get(n._state.overlay_id),e=q.get(n._state.element_id),i={width:window.innerWidth,height:"0px",left:"0px",right:"0px",opacity:.5},t=s=r=u=n.animation,u.duration=t.duration=s.duration=300,r.duration=250,u.complete=function(){return document.removeChild(o),document.removeChild(e)},s.complete=function(){return $(e).animate({opacity:0},finalAnim),$(o).animate({opacity:0},overlayAnim)},t.complete=function(){return setTimeout(function(){return m.classList.remove("dropshadow"),m.classList.remove("rounded"),m.style.padding="0px"},150),$(e).animate(i,midpointAnim)},q.get("modal-content-"+n._state.cached_id).style.overflow="hidden",$("modal-fade-"+n._state.cached_id).animate({opacity:0},t),e},this._init=function(){var e;return e=n.make(),t.removeAttribute("href"),n._state.init=!0,$.apptools.events.trigger("MODAL_READY",n),n}}return z(t,e),t}(S),this.__apptools_preinit.abstract_base_classes.push(k),this.__apptools_preinit.abstract_base_classes.push(L),this.__apptools_preinit.deferred_core_modules.push({module:L,"package":"widgets"}),t=function(){function e(e){var t,n,r,i,s,o=this;this.config={rpc:{base_uri:"/_api/rpc",host:null,enabled:!0},sockets:{host:null,enabled:!1}},this.lib={},this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED"],state:{status:"NOT_READY",flags:["base"],modules:{},classes:{},interfaces:{},integrations:[],add_flag:function(e){return this.sys.flags.push(e)},consider_preinit:function(t){var n,r,i,s,u,a,f,l,c,h,p,d;if(t.abstract_base_classes!=null){h=t.abstract_base_classes;for(i=0,f=h.length;i<f;i++){n=h[i],o.sys.state.classes[n.name]=n,n["package"]!=null&&o.sys.state.modules[n["package"]]!=null&&(o.sys.state.modules[n["package"]].classes[n.name]=n);if(n["export"]!=null&&n["export"]==="private")continue;e[n.name]=n}}if(t.deferred_library_integrations!=null){p=t.deferred_library_integrations;for(u=0,l=p.length;u<l;u++)r=p[u],o.sys.libraries.install(r.name,r.library)}if(t.abstract_feature_interfaces!=null){d=t.abstract_feature_interfaces;for(a=0,c=d.length;a<c;a++)s=d[a],o.sys.interfaces.install(s.name,s.adapter)}return t}},modules:{install:function(t,n,r){var i,s,u,a;return n==null&&(n=null),r==null&&(r=null),n!=null&&(typeof n=="function"?(r=n,s=null):s=n),s!=null?(o[s]==null&&(o[s]={}),s=o[s],u=!0):(s=o,u=!1),t.mount!=null?i=t.mount:i=t.name.toLowerCase(),t.events!=null&&o.events!=null&&o.events.register(t.events),s[i]==null&&(u?(a=s[i]=new t(o,s,e),o.sys.state.modules[i]={module:a,classes:{}}):(a=s[i]=new t(o,e),o.sys.state.modules[i]={module:a,classes:{}})),t._init!=null&&t._init(o),o.dev!=null&&o.dev.verbose!=null&&o.dev.verbose("ModuleLoader","Installed module:",a," at mountpoint: ",s," under the name: ",i),o.events!=null&&o.events.trigger("SYS_MODULE_LOADED",{module:a,mountpoint:s}),r!=null&&r(a),a}},libraries:{install:function(e,t,n){return n==null&&(n=null),o.lib[e.toLowerCase()]=t,o.sys.state.integrations.push(e.toLowerCase()),o.dev.verbose("LibLoader",e+" detected."),o.events.trigger("SYS_LIB_LOADED",{name:e,library:t}),n!=null&&n(t,e),o.lib[e.toLowerCase()]},resolve:function(e){var t,n,r,i;e=e.toLowerCase(),i=o.sys.state.integrations;for(n=0,r=i.length;n<r;n++){t=i[n];if(t!==e)continue;return o.lib[e.toLowerCase()]}}},interfaces:{install:function(e,t){return o.dev.verbose("InterfaceLoader",'Installed "'+e+'" interface.'),o.events.trigger("SYS_INTERFACE_LOADED",{name:e,adapter:t}),o.sys.state.interfaces[e]={adapter:t,methods:t.methods},o.sys.state.interfaces[e]},resolve:function(e){return o.sys.state.interfaces[e]!=null?o.sys.state.interfaces[e]:!1}},drivers:{query:{},loader:{},transport:{},storage:{},render:{},install:function(e,t,n,r,i,s,u){return u==null&&(u=null),o.sys.drivers[e][t]={name:t,driver:r,enabled:i,priority:s,"interface":n},u!=null&&u(o.sys.drivers[e][t].driver),o.events.trigger("SYS_DRIVER_LOADED",o.sys.drivers[e][t]),o.sys.drivers[e][t]},resolve:function(e,t,n){var r,i,s;t==null&&(t=null),n==null&&(n=!1);if(o.sys.drivers[e]==null){apptools.dev.critical("CORE",'Unkown driver type "'+e+'".');return}if(t!=null)return o.sys.drivers[e][t]!=null?o.sys.drivers[e][t].driver:(n&&apptools.dev.critical("CORE","Could not resolve driver ",t," of type ",e,"."),!1);i=-1,s=!1;for(r in o.sys.drivers[e]){r=o.sys.drivers[e][r];if(r.priority>i){s=r;break}}return s}},go:function(){return o.dev.log("Core","All systems go."),o.sys.state.status="READY",o}},this.sys.modules.install(f,function(e){return e.verbose("CORE","CoreDevAPI is up and running.")}),this.sys.modules.install(c,function(e){return e.register(o.sys.core_events)}),e.__apptools_preinit!=null&&this.sys.state.consider_preinit(e.__apptools_preinit),(e!=null?e.Modernizr:void 0)!=null&&this.sys.libraries.install("Modernizr",e.Modernizr,function(e,t){return o.load=function(){var e,t;return e=1<=arguments.length?R.call(arguments,0):[],(t=o.lib.modernizr).load.apply(t,e)}}),(e!=null?e.jQuery:void 0)!=null&&this.sys.libraries.install("jQuery",e.jQuery,function(e,t){return o.sys.drivers.install("query","jquery",o.sys.state.classes.QueryDriver,o.lib.jquery,!0,100,null),o.sys.drivers.install("transport","jquery",o.sys.state.classes.RPCDriver,o.lib.jquery,!0,100,null)}),(e!=null?e.Zepto:void 0)!=null&&this.sys.libraries.install("Zepto",e.Zepto,function(e,t){return o.sys.drivers.install("query","zepto",o.sys.state.classes.QueryDriver,o.lib.zepto,!0,500,null),o.sys.drivers.install("transport","zepto",o.sys.state.classes.RPCDriver,o.lib.zepto,!0,500,null)}),(e!=null?e._:void 0)!=null&&this.sys.libraries.install("Underscore",e._,function(e,t){return o.sys.drivers.install("query","underscore",o.sys.state.classes.QueryDriver,o.lib.underscore,!0,50,null),o.sys.drivers.install("render","underscore",o.sys.state.classes.RenderDriver,o.lib.underscore,!0,50,null)}),(e!=null?e.Backbone:void 0)!=null&&this.sys.libraries.install("Backbone",e.Backbone),(e!=null?e.Lawnchair:void 0)!=null&&this.sys.libraries.install("Lawnchair",e.Lawnchair,function(e){return o.sys.drivers.install("storage","lawnchair",o.sys.state.classes.StorageDriver,o.lib.lawnchair,!0,500,function(e){return o.dev.verbose("Lawnchair","Storage is currently stubbed. Come back later.")})}),(e!=null?e.amplify:void 0)!=null&&this.sys.libraries.install("Amplify",e.amplify,function(e){return o.sys.drivers.register("transport","amplify",o.sys.state.classes.RPCDriver,o.lib.amplify,!0,500,null),o.sys.drivers.register("storage","amplify",o.sys.state.classes.StorageDriver,o.lib.amplify,!0,100,null)}),(e!=null?e.Milk:void 0)!=null&&this.sys.libraries.install("Milk",e.Milk,function(e){return o.sys.drivers.install("render","milk",o.sys.state.classes.RenderDriver,o.lib.milk,!0,100,function(e){return o.dev.verbose("Milk","Render support is currently stubbed. Come back later.")})}),(e!=null?e.Mustache:void 0)!=null&&this.sys.libraries.install("Mustache",e.Mustache,function(e){return o.sys.drivers.register("render","mustache",o.sys.state.classes.RenderDriver,o.lib.mustache,!0,500,function(e){return o.dev.verbose("Mustache","Render support is currently stubbed. Come back later.")})}),this.sys.modules.install(d),this.sys.modules.install(a),this.sys.modules.install(l),this.sys.modules.install(y),this.sys.modules.install(g),this.sys.modules.install(E),this.sys.modules.install(w),this.sys.modules.install(b);if(((i=e.__apptools_preinit)!=null?i.deferred_core_modules:void 0)!=null){s=e.__apptools_preinit.deferred_core_modules;for(n=0,r=s.length;n<r;n++)t=s[n],t["package"]!=null?this.sys.modules.install(t.module,t["package"]):this.sys.modules.install(t.module)}return this.sys.go()}return e.version={major:0,minor:1,micro:4,build:4282012,release:"BETA",get:function(){return[[[this.major.toString(),this.minor.toString(),this.micro.toString()].join("."),this.build.toString()].join("-"),this.release].join(" ")}},e}(),window.AppTools=t,window.apptools=new t(window),window.jQuery!=null?$.extend({apptools:window.apptools}):(window.$=function(e){return document.getElementById(e)},window.$.apptools=window.apptools)}).call(this);